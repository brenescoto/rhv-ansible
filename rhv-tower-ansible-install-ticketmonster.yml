- name: Refresh CloudForms VMs
  connection: local
  hosts: all
  gather_facts: no
  tasks:  
    - name: Pause for 5 minutes to finish VM Creation Process.
      pause:
        minutes: 5
    
    - name: Refresh CloudForms VM
      uri:
        url: "{{ cloudforms.href }}"
        method: POST
        user: "{{ cf_user }}"
        password: "{{ cf_pw }}"
        force_basic_auth: yes
        validate_certs: no
        status_code: 200
        HEADER_Content-Type: 'application/json'
        HEADER_Accept: 'application/json'
        body: >
          {
             "action" : "refresh"
          }
      delegate_to: localhost
      until: ansible_ssh_host is defined
      retries: 10
      delay: 10

- name: Install Ticketmonster App
  hosts: all
  
  roles:
   - common
   - jboss-standalone
   - java-app
